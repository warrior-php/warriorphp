{% extends './layout.twig' %}

{% block mainWrapper %}
    <div id="main-wrapper" class="auth-customizer-none">
        <div class="position-relative overflow-hidden radial-gradient min-vh-100 w-100 d-flex align-items-center justify-content-center">
            <div class="d-flex align-items-center justify-content-center w-100">
                <div class="row justify-content-center w-100">
                    <div class="col-md-8 col-lg-6 col-xxl-3 auth-card">
                        <div class="card mb-0">
                            <div class="card-body">
                                <a href="{{ url('index') }}" class="text-nowrap logo-img text-center d-block mb-5 w-100">
                                    <img src="{{ __ASSETS__('images/logos/dark-logo.svg') }}" class="dark-logo" alt="Logo-Dark"/>
                                    <img src="{{ __ASSETS__('images/logos/light-logo.svg') }}" class="light-logo" alt="Logo-light"/>
                                </a>
                                <div class="row">
                                    <div class="col-6 mb-2 mb-sm-0">
                                        <a class="btn text-dark border fw-normal d-flex align-items-center justify-content-center rounded-2 py-8" href="javascript:void(0)" role="button">
                                            <img src="{{ __ASSETS__('images/svgs/google-icon.svg') }}" alt="modernize-img" class="img-fluid me-2" width="18" height="18">
                                            <span class="flex-shrink-0">{{ trans("admin.login.key4") }}</span>
                                        </a>
                                    </div>
                                    <div class="col-6">
                                        <a class="btn text-dark border fw-normal d-flex align-items-center justify-content-center rounded-2 py-8" href="javascript:void(0)" role="button">
                                            <img src="{{ __ASSETS__('images/svgs/facebook-icon.svg') }}" alt="modernize-img" class="img-fluid me-2" width="18" height="18">
                                            <span class="flex-shrink-0">{{ trans("admin.login.key5") }}</span>
                                        </a>
                                    </div>
                                </div>
                                <div class="position-relative text-center my-4">
                                    <p class="mb-0 fs-4 px-3 d-inline-block bg-body text-dark z-index-5 position-relative">{{ trans("admin.login.key3") }}</p>
                                    <span class="border-top w-100 position-absolute top-50 start-50 translate-middle"></span>
                                </div>
                                <form>
                                    <div class="mb-3">
                                        <label for="exampleInputEmail1" class="form-label">{{ trans("admin.login.key1") }}</label>
                                        <input type="email" class="form-control" id="exampleInputEmail1" aria-describedby="emailHelp">
                                    </div>
                                    <div class="mb-4">
                                        <label for="exampleInputPassword1" class="form-label">{{ trans("admin.login.key2") }}</label>
                                        <input type="password" class="form-control" id="exampleInputPassword1">
                                    </div>
                                    <div class="d-flex align-items-center justify-content-between mb-4">
                                        <div class="form-check">
                                            <input class="form-check-input primary" type="checkbox" id="flexCheckChecked">
                                            <label class="form-check-label text-dark" for="flexCheckChecked">{{ trans("admin.login.key6") }}</label>
                                        </div>
                                    </div>
                                    <a href="../main/index.html" class="btn btn-primary w-100 py-8 mb-4 rounded-2">{{ trans("admin.login.key7") }}</a>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="btn-group position-absolute" style="bottom: 14px; left: 10px;">
                <button type="button" class="btn border-0 dropdown-toggle d-flex align-items-center"
                        data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24">
                        <circle cx="12" cy="12" r="10" fill="currentColor" opacity="0.5"/>
                        <path fill="currentColor"
                              d="M8.575 9.447C8.388 7.363 6.781 5.421 6 4.711l-.43-.37A9.96 9.96 0 0 1 12 2c2.214 0 4.26.72 5.916 1.936c.234.711-.212 2.196-.68 2.906c-.17.257-.554.577-.976.88c-.95.683-2.15 1.02-2.76 2.278a1.42 1.42 0 0 0-.083 1.016c.06.22.1.459.1.692c.002.755-.762 1.3-1.517 1.292c-1.964-.021-3.25-1.604-3.425-3.553m4.862 8.829c.988-1.862 4.281-1.862 4.281-1.862c3.432-.036 3.896-2.12 4.206-3.173a10.006 10.006 0 0 1-8.535 8.664c-.323-.68-.705-2.21.048-3.629"/>
                    </svg>
                    <span class="text-dark ms-1" id="currentLang">English</span>
                </button>
                <ul class="dropdown-menu animated">
                    <li><a class="dropdown-item active" href="javascript:void(0)">English</a></li>
                    <li><a class="dropdown-item" href="javascript:void(0)">Japanese</a></li>
                    <li><a class="dropdown-item" href="javascript:void(0)">Chinese</a></li>
                </ul>
            </div>
        </div>
    </div>
{% endblock %}

{% block script %}
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const dropdownItems = document.querySelectorAll('.dropdown-item');
            const currentLang = document.getElementById('currentLang');

            dropdownItems.forEach(item => {
                item.addEventListener('click', async function () {
                    const lang = this.getAttribute('data-lang');
                    try {
                        const res = await fetch('/setLang', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify({lang})
                        });
                        const data = await res.json();
                        if (data.code === 200) {
                            // 清除旧状态
                            dropdownItems.forEach(i => {
                                i.classList.remove('active');
                                const check = i.querySelector('.checkmark');
                                if (check) check.remove();
                            });
                            // 设置当前项
                            this.classList.add('active');
                            this.insertAdjacentHTML('beforeend', ' <span class="checkmark">✔</span>');
                            // 更新显示文字
                            currentLang.textContent = this.textContent.replace('✔', '').trim();
                            console.log('语言已切换为：', lang);
                        } else {
                            alert('切换失败：' + data.msg);
                        }
                    } catch (e) {
                        alert('请求失败');
                    }
                });
            });
        });
    </script>
{% endblock %}